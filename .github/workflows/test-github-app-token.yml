name: "üîç Test: GitHub App Installation Token"

on:
  workflow_dispatch:

jobs:
  mint_and_validate:
    uses: ./.github/workflows/reusable-github-app-token.yml
    secrets:
      APP_ID: ${{ secrets.APP_ID }}
      APP_PRIVATE_KEY: ${{ secrets.APP_PRIVATE_KEY }}

  validate:
    needs: mint_and_validate
    runs-on: ubuntu-24.04-arm
    steps:
      - name: ‚úÖ Verify token works
        run: |
          echo "Token obtained from reusable job. Attempting to query repo via gh..."
          echo "${{ needs.mint_and_validate.outputs.installation_token }}" | gh auth login --with-token || true
          gh repo view --json name,owner -q '.name + " by " + .owner.login' && echo "‚úÖ Authenticated as app installation"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
